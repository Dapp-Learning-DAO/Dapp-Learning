# 介绍
ERC-404 是一个实验性的混合 ERC-20 / ERC-721 实现，具有本地流动性和分级。虽然这两个标准并非设计用于混合，但这个实现力求以尽可能健壮的方式进行，同时尽量减少权衡。

在当前的实现中，ERC-404 有效地隔离了 ERC-20 / ERC-721 标准逻辑，或者在可能的情况下引入了路径。

路径可以最好地被描述为一种有损编码方案，其中令牌数量数据和 id 占据共享空间，假设占据 id 空间的可忽略令牌转移不会发生或者不需要发生。

集成协议应理想地通过检查提交的参数是否在令牌 id 范围之下或之上来确认这些路径。

ERC-404 的这一次迭代具体旨在解决常见用例，并为标准化定义更好的接口，以减少或消除与现有 ERC-20 / ERC-721 共识的冲突。

# 主要函数介绍
## transfer(address to, uint256 value)
### 与 ERC20不同的地方
这个函数 _transferERC20WithERC721 与普通的 ERC20 的 transfer 函数不同之处在于它额外处理了相关的 ERC721 代币。普通的 ERC20 transfer 函数只负责在两个地址之间转移 ERC20 代币，而不涉及处理其他类型的代币。

相比之下，_transferERC20WithERC721 函数在转移 ERC20 代币的同时，考虑了发送者和接收者是否拥有与其 ERC20 余额相关联的 ERC721 代币，并根据不同的情况执行相应的操作，例如转移或铸造、存储或提取 ERC721 代币。因此，这个函数在处理 ERC20 转移时，额外考虑了 ERC721 代币的相关逻辑，以确保两者之间的关联性。

## transferFrom(address from_,address to_,uint256 valueOrId_)
### 与 ERC20不同的地方
这个函数 `transferFrom` 与传统的 ERC721 的 `transferFrom` 函数不同之处在于它实现了混合转移，即可以同时处理 ERC20 和 ERC721 代币的转移。

下面是两者之间的主要不同点：

1. **处理逻辑**：
   - 传统的 ERC721 `transferFrom` 函数主要用于在不同地址之间转移特定的 ERC721 代币。它要求操作者必须有相应的授权才能进行转移。
   - 而 `transferFrom` 函数在接收到参数 `valueOrId_` 后，根据该值的大小来判断是进行 ERC20 还是 ERC721 的转移。如果小于等于当前的最大 ID（`_minted`），则认为是 ERC721 转移；否则认为是 ERC20 转移。

2. **转移逻辑**：
   - 对于 ERC721 转移，`transferFrom` 函数执行了一系列的检查，包括验证发送者是否拥有该代币、操作者是否有足够的授权以及双方是否在 ERC721 转移豁免列表中等。然后调用 `_transferERC20` 和 `_transferERC721` 函数来执行转移。
   - 对于 ERC20 转移，函数调用了 `_transferERC20WithERC721` 函数来处理。这个函数在转移 ERC20 代币的同时，额外考虑了 ERC721 代币的相关逻辑，以确保两者之间的关联性。

因此，`transferFrom` 函数通过判断参数值的大小，实现了根据需要进行 ERC20 或 ERC721 的混合转移，使得合约具有更灵活的功能。
