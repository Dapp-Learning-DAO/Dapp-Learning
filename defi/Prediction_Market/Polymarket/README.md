# Polymarket
## 介绍
Polymarket是一个基于Matic Network的去中心化预测市场平台，允许用户对各种公共事件进行预测下注。由纽约大学的辍学生Shayne Coplan创建,本文将详细介绍Polymarket的使用与智能合约交互部分，以及如何完成预测清算。


随着美国新一届大选的临近,关于新的总统候选人的讨论越来越火爆,而围绕着总统候选人展开博弈的去中心化预测市场平台也受到越来越多人们的关注



## 机制及原理


Polymarket通过去中心化的方式，使用户能够参与各种公共事件的预测，并在事件结果确定后进行清算。用户可以通过智能合约创建市场、参与交易和结算收益。Polymarket的核心实现方法由以下几个部分组合而成。



#### Proxy钱包
当用户首次进行交易前，他们会被提示创建一个钱包。用户会被引导在 Polygon 上部署一个1 of 1 多签钱包，这个钱包由用户钱包（EOA）控制和拥有（例如MetaMask）该多签钱包用于存放用户的所有positions（预测，以ERC1155形式存在）和 USDC。

使用Proxy钱包能够提升用户体验，尤其在处理交易费用、批量交易处理以及交易执行的安全性和便利性方面表现突出，主要为以下几个方面:

1. 中继者代付Gas费用
2. 批量交易处理
3. 免gas通过签名授权执行合约的逻辑

用户只需在本地生成transaction的signature 并发出，无需直接与区块链交互。Polymarket接收到签名交易后，验证签名的有效性并执行诸如approve/buy/sell等操作。这种机制确保了交易的便利性和安全性，同时用户私钥也不存储在服务器上。同时，也使polymarket可以将多笔交易打包为一笔交易同时执行以大大降低gas消耗。



#### CTF结果代币

Polymarket 利用条件代币为用户提供了一个独特且动态的预测方式。在 Polymarket 上，所有的预测结果都通过 Gnosis 的条件代币框架（Conditional Tokens Framework, CTF）在 Polygon 上进行代币化。这些结果代币为二元结果，代表“YES”和“NO”，使用 ERC1155 代币实现。

结果代币将会有三个生命周期,分别是
1. 通过split质押USDC并创造出Yes 和 No两个代币
2. 在市场上自由交易阶段以及自由组合复合资产
3. 通过Merge在结算前退出市场或在结算后通过Redeem赎回质押的USDC

以下是针对一个预测的两种获利情景,假设最终YES获得了胜利

情况一：当用户是铸造者（即初期投入并分割代币的人）

    1. 初始投入：用户质押1 USDC并通过 split 操作获得1个“YES”代币和1个“NO”代币。
    2. 出售“NO”代币：用户相信结果会是“YES”，因此他决定出售“NO”代币。出售的价格取决于市场对“NO”结果的需求和预期。最终用户以0.4 USDC的价格出售了“NO”代币。
    3. 事件结果为“YES”：当事件结果确定为“YES”后，用户使用“YES”代币通过 redeem 操作兑换回1 USDC。
    4. 计算总收益:因此，总收益是1 USDC (赎回) + 0.4 USDC (出售“NO”) - 1 USDC (初始投入) = 0.4 USDC。

情况二：当用户是购买了“YES”代币的人

    1. 购买“YES”代币：用户在市场上购买不看好YES的人出售的“YES”代币，假设购买价格是0.6 USDC。
    2. 事件结果为“YES”：事件结果确定为“YES”后，用户使用“YES”代币通过 redeem 操作兑换回1 USDC。
    3. 计算总收益：用户从“YES”代币的赎回中获得1 USDC。因此，总收益是1 USDC (赎回) - 0.6 USDC (购买“YES”) = 0.4 USDC。

结论

	对于 split者，他们的盈利来自于成功出售他们不看好的结果代币（在这个例子中是“NO”）的收益以及对正确结果的赎回。
	对于 购买者，他们的盈利来自于购买代币的成本与赎回获得的价值之间的差额。
    
在一个长期预测中(例如美国大选),往往结果瞬息万变,当预测事件的结果预期发生变化时，用户通过 merge 和 购买代币 的策略，能有效地管理和调整他们的投资和潜在的风险敞口，从而降低潜在风险。这种灵活性是预测市场特有的，也是吸引投资者参与的重要因素之一。

通过以下案例可以帮助你更快的理解结果代币作为衍生品的潜力

    假设某对冲基金想要做空Doge代币,但是Doge代币作为单边操作势必会有风险,所以他可以在polymarket上发布一个预测,将Doge强相关的几个KOL发布积极内容作为对冲风险资产:例如3个月内elon musk是否会积极的称赞Doge,并通过控制持有的条件代币来与单边的做空策略形成对冲


通过使用结果代币的方式,Polymarket将去中心化预测市场与其他金融产品非常完美的结合起来.用户不仅可以买入代币用于预测,还可以使用金融杠杆做空认为不会发生的事情.应对预测期很长的项目时,用户也可以将他们认同的预测结果通过代币打包成复合资产,这使得polymarket灵活度大大提升

#### UMA

Polymarket 上大部分预测都是"抽象预测",其结果不能通过传统链上预言机来喂价实现(区别于传统对币价的预测)，所以通过整合 UMA 的乐观预言机 (Optimistic Oracle, OO) 来实现去中心化的市场决议。UMA 的预言机系统提供了一种机制，使合约能够请求并接收数据信息，以此支持对抽象问题的预测和解决。

UMA 通常以乐观的方式处理数据验证,这意味着:当一个数据请求被发起时，如果没有争议，该数据将被默认为正确。在数据提交后的挑战期内，任何市场参与者都可以成为反驳者，他们可以挑战提交的数据(这有点像Optimistic的乐观模式)


当乐观预言机（Optimistic Oracle, OO）提交的数据遭到质疑时，就会涉及到一个去中心化的投票过程来解决分歧。

投票者来源于UMA代币持有者群体。这些持有者通常是投资者、开发者或者是对UMA平台有治理兴趣的用户。任何持有UMA代币并在DVM中注册的用户都有权参与到数据争议的解决过程中。在UMA的数据验证机制（DVM）中，投票权不仅仅基于持有的UMA代币数量，还取决于这些代币是否已经被质押到系统中。只有被质押的UMA代币才能授予投票权，这意味着用户必须将自己的UMA代币锁定在智能合约中，才能参与到决议争议的投票中。


通过将 UMA 的预言机技术集成到其市场解决框架中，Polymarket 能够提供一个去中心化的、基于社区投票的解决方案，处理各种复杂和抽象的市场问题。Polymarket 开发了一个自定义的适配器合约 UmaCtfAdapter，这个合约作为连接 UMA 预言机和 Polymarket 条件代币框架（CTF）市场的桥梁，允许这两个系统之间的无缝交互。





#### 5. 总结

Polymarket利用Proxy钱包/CTF代币和UMA等合约实现了去中心化预测市场的创建、交易和清算。用户可以方便地参与预测市场，并在事件结果确定后获得相应收益。希望本文能帮助你更好地理解Polymarket的技术实现和使用方法。


### 参考链接

- Polymarket: https://polymarket.com/
- Polymarket相关报道: https://foresightnews.pro/search?search=polymarket&search_type=website&params_type=article
- UMA 官方文档: https://docs.uma.xyz/developers/quick-start
- gnosis CTF官方文档: https://docs.gnosis.io/conditionaltokens/docs/devguide01
- Polymarket官方文档: https://docs.polymarket.com/#introduction

